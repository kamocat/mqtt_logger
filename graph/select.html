<!DOCTYPE html>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="/graph/helper.js"></script>
<html>
    <head><title>graphing test page</title>
    </head>
    <body>
        <h1>Test graph</h1>
	<div id="sidebar" style="float:left; border:1px solid gray; padding: 20px;">
		<h2>Data</h2>
		<form id="controls">
		<input type="number" onchange="fetch_data()" name="days" value=1><label name="days">days</label><br>
		<input type="checkbox" onchange="fetch_data()" name="notes"><label name="notes">Show annotations?</label><br>
		<h3>Topic</h3>
		</form></div>
        <div id="plot1">
        </div>
    </body>
</html>
<script>
function radio(data){
  var list = document.getElementById("controls");
  for (let x in data){
		  list.innerHTML += `<input type="radio" name="topic" value=${x} onchange="fetch_data()"}><label for=${x}>${x}</label><br>`;
  }
}
    
fetch('/topics').then(response => response.json() )
.then(res => radio(res.topics))

function fetch_data(){
	let mygraph = d3.select("#plot1");
  const controls = document.forms['controls'];
	let url = "/points/" + controls["topic"].value + "?days=" + controls["days"].value;
	const date = new Date();
	const offset = date.getTimezoneOffset() * 60;
	fetch(url).then(response => response.json() )
	.then(data => AreaChart(data, {
		x: d => (d.time - offset) * 1000, //Convert to localtime 
		y: d => d.value,
		yLabel: "â†‘ Value",
		xLabel: console.log(new Date(data[0].time*1000).toLocaleDateString()),
		width: 1000,
		height: 500,
		color: "steelblue"
	}))
	.then(chart => mygraph.node().append(chart))
}
  
</script> 
